<div class="supplier-registration-container">
  <!-- Header with Logo -->
  <div class="header-section">
    <img src="assets/images/logo.png" alt="Logo" class="logo" />
    <h1>Supplier Registration & Pre-qualification</h1>
  </div>

  <form [formGroup]="supplierForm" (ngSubmit)="onSubmit()">
    <!-- Basic Information -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Basic Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Supplier Name *</mat-label>
            <input matInput formControlName="name" placeholder="As per trade license">
            <mat-hint>As per trade license</mat-hint>
            <mat-error *ngIf="supplierForm.get('name')?.hasError('required')">Supplier name is required</mat-error>
            <mat-error *ngIf="supplierForm.get('name')?.hasError('minlength')">Minimum 2 characters</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row two-columns">
          <mat-form-field appearance="outline">
            <mat-label>Tax Registration Number</mat-label>
            <input matInput formControlName="taxRegistrationNum" maxlength="15">
            <mat-hint>TRN (max 15 characters)</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Website</mat-label>
            <input matInput formControlName="website" placeholder="https://www.example.com">
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Addresses Section -->
    <mat-expansion-panel expanded="true" class="section-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>location_on</mat-icon>
          Addresses *
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="addresses-section">
        <div class="address-card" *ngFor="let address of addresses; let i = index">
          <div class="address-header">
            <span>Address {{ i + 1 }}</span>
            <button mat-icon-button color="warn" (click)="removeAddress(i)" type="button">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <div class="form-row two-columns">
            <mat-form-field appearance="outline">
              <mat-label>Address Name *</mat-label>
              <input matInput [(ngModel)]="address.name" [ngModelOptions]="{standalone: true}">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Phone Number</mat-label>
              <input matInput [(ngModel)]="address.number" [ngModelOptions]="{standalone: true}">
            </mat-form-field>
          </div>
          <div class="form-row two-columns">
            <mat-form-field appearance="outline">
              <mat-label>Country *</mat-label>
              <mat-select [(ngModel)]="address.countryId" [ngModelOptions]="{standalone: true}" (selectionChange)="onCountryChange(address)">
                <mat-option *ngFor="let country of countries" [value]="country.id">
                  {{ country.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>City *</mat-label>
              <mat-select [(ngModel)]="address.cityId" [ngModelOptions]="{standalone: true}" [disabled]="!address.countryId">
                <mat-option *ngFor="let city of getAvailableCities(address)" [value]="city.id">
                  {{ city.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <button mat-stroked-button color="primary" type="button" (click)="addAddress()" class="add-button">
          <mat-icon>add</mat-icon>
          Add Address
        </button>
      </div>
    </mat-expansion-panel>

    <!-- Representatives/Contacts Section -->
    <mat-expansion-panel expanded="true" class="section-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>people</mat-icon>
          Representatives *
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="contacts-section">
        <div class="contact-card" *ngFor="let contact of contacts; let i = index">
          <div class="contact-header">
            <span>{{ contact.designation || 'Contact ' + (i + 1) }}</span>
            <div class="contact-actions">
              <mat-slide-toggle [(ngModel)]="contact.isPrimary" [ngModelOptions]="{standalone: true}" color="primary">
                Primary Contact
              </mat-slide-toggle>
              <button mat-icon-button color="warn" (click)="removeContact(i)" type="button" [disabled]="contacts.length <= 2">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
          <div class="form-row two-columns">
            <mat-form-field appearance="outline">
              <mat-label>Designation *</mat-label>
              <input matInput [(ngModel)]="contact.designation" [ngModelOptions]="{standalone: true}">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Full Name *</mat-label>
              <input matInput [(ngModel)]="contact.name" [ngModelOptions]="{standalone: true}">
            </mat-form-field>
          </div>
          <div class="form-row three-columns">
            <mat-form-field appearance="outline">
              <mat-label>Email *</mat-label>
              <input matInput [(ngModel)]="contact.email" [ngModelOptions]="{standalone: true}" type="email" placeholder="name@company.com">
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Phone *</mat-label>
              <input matInput [(ngModel)]="contact.phone" [ngModelOptions]="{standalone: true}" placeholder="971200000000">
              <mat-icon matSuffix>phone</mat-icon>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Mobile *</mat-label>
              <input matInput [(ngModel)]="contact.mobile" [ngModelOptions]="{standalone: true}" placeholder="971500000000">
              <mat-icon matSuffix>smartphone</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <button mat-stroked-button color="primary" type="button" (click)="addContact()" class="add-button">
          <mat-icon>add</mat-icon>
          Add Contact
        </button>
      </div>
    </mat-expansion-panel>

    <!-- Categories Section -->
    <mat-expansion-panel expanded="true" class="section-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>category</mat-icon>
          Supplier Categories *
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="categories-section">
        <div class="categories-grid">
          <div class="category-list">
            <h4>Available Categories</h4>
            <mat-selection-list>
              <mat-list-option *ngFor="let category of categories"
                              [selected]="isCategorySelected(category)"
                              (click)="toggleCategory(category)">
                {{ category.name }}
              </mat-list-option>
            </mat-selection-list>
          </div>

          <div class="selected-categories">
            <h4>Selected Categories</h4>
            <mat-chip-set>
              <mat-chip *ngFor="let category of selectedCategories"
                       (removed)="removeCategory(category)"
                       removable>
                {{ category.name }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            </mat-chip-set>
            <p *ngIf="selectedCategories.length === 0" class="no-selection">
              No categories selected
            </p>
          </div>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Documents Section -->
    <mat-expansion-panel expanded="true" class="section-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>attach_file</mat-icon>
          Documents
        </mat-panel-title>
        <mat-panel-description>
          Valid formats: JPG, PNG, PDF (max 5MB)
        </mat-panel-description>
      </mat-expansion-panel-header>

      <div class="documents-section">
        <div class="file-upload-item" *ngFor="let fileUpload of fileUploads">
          <div class="file-upload-row">
            <input type="file"
                   #fileInput
                   [id]="'file-' + fileUpload.type"
                   accept=".jpg,.jpeg,.png,.pdf"
                   (change)="onFileSelected($event, fileUpload)"
                   hidden>

            <button mat-stroked-button
                    type="button"
                    [color]="fileUpload.file ? 'primary' : (fileUpload.required ? 'warn' : 'basic')"
                    (click)="fileInput.click()">
              <mat-icon>attach_file</mat-icon>
              {{ fileUpload.label }} {{ fileUpload.required ? '*' : '' }}
            </button>

            <div class="file-info" *ngIf="fileUpload.file">
              <span class="file-name">{{ fileUpload.file.fileName }}</span>
              <button mat-icon-button color="warn" type="button" (click)="removeFile(fileUpload)">
                <mat-icon>clear</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Notes Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Additional Notes</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="note" rows="4"></textarea>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <!-- Important Notes -->
    <mat-card class="notes-card">
      <mat-card-content>
        <p>
          By submitting this form, you agree to provide accurate and complete information.
          Your registration will be reviewed by our procurement team.
        </p>
        <p class="warning-text">
          <mat-icon>warning</mat-icon>
          Please ensure all required documents are uploaded before submission. Incomplete applications will be rejected.
        </p>
      </mat-card-content>
    </mat-card>

    <!-- Submit Button -->
    <div class="submit-section">
      <button mat-raised-button
              color="primary"
              type="submit"
              [disabled]="isSubmitting"
              class="submit-button">
        <mat-icon>send</mat-icon>
        {{ isSubmitting ? 'Submitting...' : 'Submit Registration' }}
        <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
      </button>
    </div>
  </form>
</div>
